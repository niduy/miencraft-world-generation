import type { BiomeValue } from './types'

const BIOME_COLORS: Record<BiomeValue, [number, number, number]> = {
	'-1': [-1, -1, -1],
	'0': [0, 0, 112],
	'1': [141, 179, 96],
	'2': [250, 148, 24],
	'3': [96, 96, 96],
	'4': [5, 102, 33],
	'5': [11, 106, 95],
	'6': [7, 249, 178],
	'7': [0, 0, 255],
	'8': [87, 37, 38],
	'9': [128, 128, 255],
	'10': [112, 112, 214],
	'11': [160, 160, 255],
	'12': [255, 255, 255],
	'13': [160, 160, 160],
	'14': [255, 0, 255],
	'15': [160, 0, 255],
	'16': [250, 222, 85],
	'17': [210, 95, 18],
	'18': [34, 85, 28],
	'19': [22, 57, 51],
	'20': [114, 120, 154],
	'21': [80, 123, 10],
	'22': [44, 66, 5],
	'23': [96, 147, 15],
	'24': [0, 0, 48],
	'25': [162, 162, 132],
	'26': [250, 240, 192],
	'27': [48, 116, 68],
	'28': [31, 95, 50],
	'29': [64, 81, 26],
	'30': [49, 85, 74],
	'31': [36, 63, 54],
	'32': [89, 102, 81],
	'33': [69, 79, 62],
	'34': [91, 115, 82],
	'35': [189, 178, 95],
	'36': [167, 157, 100],
	'37': [217, 69, 21],
	'38': [176, 151, 101],
	'39': [202, 140, 101],
	'40': [75, 75, 171],
	'41': [201, 201, 89],
	'42': [181, 181, 54],
	'43': [112, 112, 204],
	'44': [0, 0, 172],
	'45': [0, 0, 144],
	'46': [32, 32, 112],
	'47': [0, 0, 80],
	'48': [0, 0, 64],
	'49': [32, 32, 56],
	'50': [64, 64, 144],
	'51': [47, 86, 15],
	'52': [71, 132, 14],
	'53': [120, 158, 49],
	'127': [0, 0, 0],
	'129': [181, 219, 136],
	'130': [255, 188, 64],
	'131': [136, 136, 136],
	'132': [45, 142, 73],
	'133': [51, 146, 135],
	'134': [47, 255, 218],
	'140': [180, 220, 220],
	'149': [120, 163, 50],
	'151': [136, 187, 55],
	'155': [88, 156, 108],
	'156': [71, 135, 90],
	'157': [104, 121, 66],
	'158': [89, 125, 114],
	'160': [129, 142, 121],
	'161': [109, 119, 102],
	'162': [131, 155, 122],
	'163': [229, 218, 135],
	'164': [207, 197, 140],
	'165': [255, 109, 61],
	'166': [216, 191, 141],
	'167': [242, 180, 141],
	'168': [132, 149, 0],
	'169': [92, 108, 4],
	'170': [77, 58, 46],
	'171': [152, 26, 17],
	'172': [73, 144, 123],
	'173': [100, 95, 99],
	'174': [78, 48, 18],
	'175': [40, 60, 0],
	'177': [96, 164, 69],
	'178': [71, 114, 108],
	'179': [196, 196, 196],
	'180': [220, 220, 200],
	'181': [176, 179, 206],
	'182': [123, 143, 116],
	'183': [3, 31, 41],
	'184': [44, 204, 142]
}

const getBiomePixels = (biomes: BiomeValue[], sx: number, sy: number, scale: number) => {
	const pixels: number[] = []

	for (let j = 0; j < sy; j++) {
		for (let i = 0; i < sx; i++) {
			const id = biomes[j * sx + i]
			const rgb = BIOME_COLORS[id]

			if (!rgb) throw new Error(`Unknown biome id: ${id}`)

			const [r, g, b] = rgb

			for (let m = 0; m < scale; m++) {
				for (let n = 0; n < scale; n++) {
					const idx = (scale * i + n + sx * scale * (scale * j + m)) * 4

					pixels[idx + 0] = r
					pixels[idx + 1] = g
					pixels[idx + 2] = b
					pixels[idx + 3] = 255
				}
			}
		}
	}

	return pixels
}

export const getBiomesImageDimentions = (
	sx: number,
	sz: number,
	scale: number,
	mapScale: number
) => {
	const width = mapScale * sx * scale
	const height = mapScale * sz * scale
	return [width, height] as const
}

export const createImageFromBiomes = (
	biomes: BiomeValue[],
	sx: number,
	sz: number,
	scale: number,
	mapScale: number
) => {
	const pixels = getBiomePixels(biomes, sx * scale, sz * scale, mapScale * 2)

	const [width, height] = getBiomesImageDimentions(sx, sz, scale, mapScale)
	const data = new ImageData(new Uint8ClampedArray(pixels), width * 2, height * 2)

	return data
}
